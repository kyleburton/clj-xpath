<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="clj-xpath: Simplified XPath for Clojure" />

    <link rel="stylesheet" type="text/css" media="screen" href="/clj-xpath/site/stylesheets/stylesheet.css">
    <link rel="stylesheet" type="text/css" media="screen" href="/clj-xpath/site/css/transition.js.css">
    <link rel="stylesheet" type="text/css" media="screen" href="/clj-xpath/site/css/pygments.css">

    <title>API Documentation</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/kyleburton/clj-xpath">View on GitHub</a>

          <h1 id="project_title"><a href="/clj-xpath/">clj-xpath</a></h1>
          <h2 id="project_tagline">Simplified XPath for Clojure</h2>



        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">



      <section id="main_content" class="inner">
      <h1>clj-xpath <span class="caps">API</span> Reference</h1>
<h2>Creating a Document</h2>
<p>The <code>$x</code> and related functions support Strings, and in many cases, other convenient types for these arguments.  In all cases where it expects an <span class="caps">XML</span> Document it can be given a String, a byte array or a Document.  Where an xpath expression is expected it will take either a String or a pre-compiled XPathExpression.  The act of parsing an <span class="caps">XML</span> document or compiling an xpath expression is an expensive activity.  With this flexibility, clj-xpath supports the convenience of in-line usage (with String data), as well as pre-parsed and pre-compiled instances for better performance.</p>
<h2><code>(xml-&gt;doc doc) =&gt; org.w3c.dom.Document</code></h2>
<p>Creates an org.w3c.dom.Document.  The input document may be one of:</p>
<ul>
	<li><code>String</code></li>
	<li><code>byte[]</code></li>
	<li><code>org.w3c.dom.Document</code></li>
</ul>
<p>It is not necessary to pre-parse your documents to make use of the functions in <code>clj-xpath</code>, though doing so will significantly improve performance.</p>
<h2>Applying XPath Expressions</h2>
<h3><code>($x xpexpr doc) =&gt; (map [...])</code></h3>
<p>This is the main xpath application function.  It takes an xpath expression (as a string) and a document and returns a sequence of matched elements as maps.  The map contains the node&#8217;s tag, attributes, text content, the dom Node itself and a lazy sequence of the node&#8217;s children.</p>
<div class="highlight"><pre><code class="clojure"><span class="p">{</span> <span class="ss">:tag</span>      <span class="ss">:tag-name</span>
  <span class="ss">:attrs</span>    <span class="p">{</span> <span class="ss">:a</span> <span class="s">&quot;map&quot;</span> <span class="ss">:of</span> <span class="s">&quot;the attributes&quot;</span> <span class="p">}</span>
  <span class="ss">:text</span>     <span class="s">&quot;the body content of the node and it&#39;s children&quot;</span>
  <span class="ss">:node</span>     <span class="nv">org.w3c.dom.Node</span>
  <span class="ss">:children</span> <span class="nv">...seq</span> <span class="nv">of</span> <span class="nv">children...</span> <span class="p">}</span>
</code></pre></div><h2>Extraction Functions</h2>
<h3><code>($x:tag*   xpexpr doc) =&gt; [:tag-name ...]</code><br />
<code>($x:text* xpexpr doc) =&gt; ["the content" ..]</code><br />
<code>($x:attrs* xpexpr doc) =&gt; [{:the "attrs" ...} ...]</code><br />
<code>($x:node*  xpexpr doc) =&gt; [org.w3c.dom.Node ...]</code></h3>
<p>These functions apply the xpath expression to the given document and return a sequence of the text, attrs or nodes respectively.</p>
<h3><code>($x:tag?   xpexpr doc) =&gt; [:tag-name ...]</code><br />
<code>($x:text? xpexpr doc) =&gt; ["the content" ..]</code><br />
<code>($x:attrs? xpexpr doc) =&gt; [{:the "attrs" ...} ...]</code><br />
<code>($x:node?  xpexpr doc) =&gt; [org.w3c.dom.Node ...]</code></h3>
<p>These functions apply the xpath expression to the given document and return either nil or the single result found.  Unlinke the singleton forms (see below), these do not throw and exception (just returning nil).</p>
<h3><code>($x:tag+   xpexpr doc) =&gt; [:tag-name ...]</code><br />
<code>($x:text+ xpexpr doc) =&gt; ["the content" ..]</code><br />
<code>($x:attrs+ xpexpr doc) =&gt; [{:the "attrs" ...} ...]</code><br />
<code>($x:node+  xpexpr doc) =&gt; [org.w3c.dom.Node ...]</code></h3>
<p>These functions apply the xpath expression to the given document and return multiple results &#8211; throwing an exception if the xpath expression matches no elements.</p>
<h3><code>($x:tag   xpexpr doc) =&gt; :tag-name</code><br />
<code>($x:text  xpexpr doc) =&gt; "the content"</code><br />
<code>($x:attrs xpexpr doc) =&gt; {:the "attrs" ...}</code><br />
<code>($x:node  xpexpr doc) =&gt; org.w3c.dom.Node</code></h3>
<p>These functions return the requested property from the single result of executing the xpath expression.  If the xpath expression identifies less than 1 result or more than 1 result in the given document, an exception is raised.</p>
<h3><code>(abs-path node) =&gt; xpath-expression (String)</code></h3>
<p>Given a node extracted from a document (by any of the <code>$x</code> functions), returns an XPath expression (a String) that will locate the node in the document.  This may not be the xpath that was used to extract the node, but will uniquely identify the node in the document.</p>
<h2>Precompliation of XPath Expressions</h2>
<h3><code>($xp:compile xpexpr) =&gt; javax.xml.xpath.XPathExpression</code></h3>
<p>Pre-compiles the xpath expression.  In cases of repeated execution of an xpath expression this will improve performance.</p>
<h2>Validation</h2>
<p>Validation is off by default.  Validation is controlled by optional parameters passed to <code>xml-bytes-&gt;dom</code>, or by overriding the dynamic var <code>*validation*</code> to true:</p>
<div class="highlight"><pre><code class="clojure"><span class="p">(</span><span class="kd">ns </span><span class="nv">your.namespace</span>
  <span class="p">(</span><span class="ss">:use</span> <span class="nv">clj-xpath.core</span><span class="p">))</span>

<span class="p">(</span><span class="nb">binding </span><span class="p">[</span><span class="nv">*validation*</span> <span class="nv">false</span><span class="p">]</span>
  <span class="p">(</span><span class="nf">$x</span><span class="ss">:text</span> <span class="s">&quot;/this&quot;</span> <span class="s">&quot;&lt;this&gt;foo&lt;/this&gt;&quot;</span><span class="p">))</span>
</code></pre></div><h2>XPath and <span class="caps">XML</span> Namespaces</h2>
<p>These examples assume the following <span class="caps">XML</span> document:</p>
<div class="highlight"><pre><code class="xml"><span class="nt">&lt;atom:feed</span> <span class="na">xml:base=</span><span class="s">&quot;http://nplhost:8042/sap/opu/sdata/IWFND/RMTSAMPLEFLIGHT/&quot;</span>
                  <span class="na">xmlns:atom=</span><span class="s">&quot;http://www.w3.org/2005/Atom&quot;</span>
                  <span class="na">xmlns:d=</span><span class="s">&quot;http://schemas.microsoft.com/ado/2007/08/dataservices&quot;</span>
                  <span class="na">xmlns:m=</span><span class="s">&quot;http://schemas.microsoft.com/ado/2007/08/dataservices/metadata&quot;</span>
                  <span class="na">xmlns:sap=</span><span class="s">&quot;http://www.sap.com/Protocols/SAPData&quot;</span><span class="nt">&gt;</span>

  <span class="nt">&lt;atom:title&gt;</span>BookingCollection<span class="nt">&lt;/atom:title&gt;</span>
  <span class="nt">&lt;atom:updated&gt;</span>2012-03-19T20:27:30Z<span class="nt">&lt;/atom:updated&gt;</span>

  <span class="nt">&lt;atom:entry&gt;</span>
    <span class="nt">&lt;atom:author/&gt;</span>
  <span class="nt">&lt;/atom:entry&gt;</span>

  <span class="nt">&lt;atom:entry&gt;</span>
    <span class="nt">&lt;atom:author/&gt;</span>
    <span class="nt">&lt;atom:content</span> <span class="na">type=</span><span class="s">&quot;application/xml&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/atom:entry&gt;</span>

<span class="nt">&lt;/atom:feed&gt;</span>
</code></pre></div><p>To use the xpath library with an <span class="caps">XML</span> document that utilizes <span class="caps">XML</span> namespaces, you can make use of the `with-namespace-context` macro providing a map of aliases to the xmlns <span class="caps">URL</span>:</p>
<div class="highlight"><pre><code class="clojure"><span class="p">(</span><span class="k">def </span><span class="nv">xml</span> <span class="p">(</span><span class="nb">slurp </span><span class="s">&quot;fixtures/namespace1.xml&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="nf">with-namespace-context</span> <span class="p">{</span><span class="s">&quot;atom&quot;</span> <span class="s">&quot;http://www.w3.org/2005/Atom&quot;</span><span class="p">}</span>
  <span class="p">(</span><span class="nf">$x</span><span class="ss">:text</span> <span class="s">&quot;//atom:title&quot;</span> <span class="nv">xml-doc</span><span class="p">))</span>
<span class="c1">;; =&gt; BookingCollection</span>
</code></pre></div><p>There is also a utility function that can pull the namespace declarations from the root node of your <span class="caps">XML</span> document:</p>
<div class="highlight"><pre><code class="clojure"><span class="p">(</span><span class="k">def </span><span class="nv">xml</span> <span class="p">(</span><span class="nb">slurp </span><span class="s">&quot;fixtures/namespace1.xml&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="nf">with-namespace-context</span> <span class="p">(</span><span class="nf">xmlnsmap-from-root-node</span> <span class="nv">xml-doc</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">$x</span><span class="ss">:text</span> <span class="s">&quot;//atom:title&quot;</span> <span class="nv">xml-doc</span><span class="p">))</span>
<span class="c1">;; =&gt; BookingCollection</span>
</code></pre></div>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">cl-xpath maintained by <a href="https://github.com/kyleburton">kyleburton</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

  </body>
</html>
